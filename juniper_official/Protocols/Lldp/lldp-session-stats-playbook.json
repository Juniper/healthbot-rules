{
            "topic" : [
            {
                "topic-name" : "protocol.lldp",
                "description" : "This topic is to monitor and notify lldp statitics i.e. neighbor state, frame discards, frame errors, tlv discards and unknown tlvs",
                "synopsis" : "lldp session statistics analyzer",
                "rule" : [
                {
                    "rule-name" : "check-lldp-session",
                    "keys" : ["interface-name"],
                    "synopsis" : "lldp session state analyzer",
                    "description" : "This rule collects lldp session state periodically and notifies in case of anomalies",
                    "sensor" : [
                    {
                        "sensor-name" : "lldp-sensor",
                        "synopsis" : "lldp open-config sensor definition",
                        "description" : "/lldp open-config sensor to collect telemetry data from network device",
                        "open-config" : {
                            "sensor-name" : "/lldp/",
                            "frequency" : "10s"
                        }
                    }
                    ],
                    "field" : [
                    {
                        "field-name" : "if-lldp-state",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/enabled"
                        }
                        ],
                        "type" : "string",
                        "description" : "This field is for local interface lldp state"
                    },
                    {
                        "field-name" : "interface-name",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "where" : "/lldp/interfaces/interface/@name =~ /{{interface_name}}/",
                            "path" : "/lldp/interfaces/interface/@name"
                        }
                        ],
                        "type" : "string",
                        "description" : "This field is for interface name"
                    },
                    {
                        "field-name" : "neighbor-state",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/neighbors/neighbor/capabilities/capability/state/enabled"
                        }
                        ],
                        "type" : "string",
                        "description" : "This field is for lldp neighbor state"
                    }
                    ],
                    "trigger" : [
                    {
                        "trigger-name" : "lldp-session-state",
                        "synopsis" : "lldp state kpi",
                        "description" : "Ignores lldp disabled interfaces. Sets health based on lldp session
state.",
                        "term" : [
                        {
                            "term-name" : "is-lldp-disabled",
                            "when" : {
                                "does-not-match-with" : [
                                {
                                    "left-operand" : "$if-lldp-state",
                                    "right-operand" : "true"
                                }
                                ]
                            }
                        },
                        {
                            "term-name" : "is-lldp-session-up",
                            "when" : {
                                "matches-with" : [
                                {
                                    "left-operand" : "$neighbor-state",
                                    "right-operand" : "true"
                                }
                                ]
                            },
                            "then" : {
                                "status" : {
                                    "color" : "green",
                                    "message" : "Interface-$interface-name llpd session is up"
                                }
                            }
                        },
                        {
                            "term-name" : "lldp-session-down",
                            "then" : {
                                "status" : {
                                    "color" : "red",
                                    "message" : "Interface-$interface-name llpd session down"
                                }
                            }
                        }
                        ]
                    }
                    ],
                    "variable" : [
                    {
                        "name" : "interface_name",
                        "value" : "ge-././.|xe-././.",
                        "description" : "Enter specific or all interfaces to be monitored using regular expression",
                        "type" : "string"
                    }
                    ]
                },
                {
                    "rule-name" : "check-lldp-session-statistics",
                    "keys" : ["interface-name"],
                    "synopsis" : "lldp session statistics analyzer",
                    "description" : "This rule collects lldp session statistics(frame&tlv-discards, frame-in&out errors and unknown tlvs) periodically and notifies in case of anomalies",
                    "sensor" : [
                    {
                        "sensor-name" : "lldp-sensor",
                        "synopsis" : "lldp open-config sensor definition",
                        "description" : "/lldp open-config sensor to collect telemetry data from network device",
                        "open-config" : {
                            "sensor-name" : "/lldp/",
                            "frequency" : "10s"
                        }
                    }
                    ],
                    "field" : [
                    {
                        "field-name" : "frame-discards",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/counters/frame-discard"
                        }
                        ],
                        "type" : "integer",
                        "description" : "This field is for lldp session frame discards"
                    },
                    {
                        "field-name" : "frame-discards-threshold",
                        "constant" : {
                            "value" : "{{frame_discards_threshold}}"
                        },
                        "type" : "integer",
                        "description" : "Set lldp session frame discards threshold"
                    },
                    {
                        "field-name" : "frame-error-in",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/counters/frame-error-in"
                        }
                        ],
                        "type" : "integer",
                        "description" : "This field is for lldp session session input frame errors"
                    },
                    {
                        "field-name" : "frame-error-in-threshold",
                        "constant" : {
                            "value" : "{{frame_error_in_threshold}}"
                        },
                        "type" : "integer",
                        "description" : "Set lldp session frame in errors threshold"
                    },
                    {
                        "field-name" : "frame-error-out",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/counters/frame-error-out"
                        }
                        ],
                        "type" : "integer",
                        "description" : "This field is for lldp session session output frame errors"
                    },
                    {
                        "field-name" : "frame-error-out-threshold",
                        "constant" : {
                            "value" : "{{frame_error_out_threshold}}"
                        },
                        "type" : "integer",
                        "description" : "Set lldp session frame out errors threshold"
                    },
                    {
                        "field-name" : "if-lldp-state",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/enabled"
                        }
                        ],
                        "type" : "string",
                        "description" : "This field is for local interface lldp state"
                    },
                    {
                        "field-name" : "interface-name",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "where" : "/lldp/interfaces/interface/@name =~ /{{interface_name}}/",
                            "path" : "/lldp/interfaces/interface/@name"
                        }
                        ],
                        "type" : "string",
                        "description" : "This field is for interface name"
                    },
                    {
                        "field-name" : "neighbor-state",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/neighbors/neighbor/capabilities/capability/state/enabled"
                        }
                        ],
                        "type" : "string",
                        "description" : "This field is for lldp neighbor state"
                    },
                    {
                        "field-name" : "tlv-discards",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/counters/tlv-discard"
                        }
                        ],
                        "type" : "integer",
                        "description" : "This field is for lldp session tlv discards"
                    },
                    {
                        "field-name" : "tlvs-discards-threshold",
                        "constant" : {
                            "value" : "{{tlv_discards_threshold}}"
                        },
                        "type" : "integer",
                        "description" : "Set lldp session tlv discards threshold"
                    },
                    {
                        "field-name" : "unknown-tlvs",
                        "sensor" : [
                        {
                            "sensor-name" : "lldp-sensor",
                            "path" : "/lldp/interfaces/interface/state/counters/tlv-unknown"
                        }
                        ],
                        "type" : "integer",
                        "description" : "This field is for lldp session unknown tlvs"
                    },
                    {
                        "field-name" : "unknown-tlvs-threshold",
                        "constant" : {
                            "value" : "{{unknown_tlvs_threshold}}"
                        },
                        "type" : "integer",
                        "description" : "Set lldp session frame discards threshold"
                    }
                    ],
                    "trigger" : [
                    {
                        "trigger-name" : "frame-discards",
                        "synopsis" : "lldp frame-discards kpi",
                        "description" : "Sets health based on lldp session frame discards count threshold value",
                        "term" : [
                        {
                            "term-name" : "skip-lldp-disabled",
                            "when" : {
                                "does-not-match-with" : [
                                {
                                    "left-operand" : "$if-lldp-state",
                                    "right-operand" : "true"
                                }
                                ]
                            }
                        },
                        {
                            "term-name" : "are-frame-discards",
                            "when" : {
                                "min-rate-of-increase" : [
                                {
                                    "field-name" : "$frame-discards",
                                    "rate" : "$frame-discards-threshold",
                                    "time-range" : "60s"
                                }
                                ]
                            },
                            "then" : {
                                "status" : {
                                    "color" : "red",
                                    "message" : "frame-discards count is:$frame-discards"
                                }
                            }
                        },
                        {
                            "term-name" : "no-frame-discards",
                            "then" : {
                                "status" : {
                                    "color" : "green",
                                    "message" : "frame-discards count is:$frame-discards"
                                }
                            }
                        }
                        ]
                    },
                    {
                        "trigger-name" : "frame-error-in",
                        "synopsis" : "lldp frame input errors kpi",
                        "description" : "Sets health based on lldp session frame in error count threshold value",
                        "term" : [
                        {
                            "term-name" : "skip-lldp-disabled",
                            "when" : {
                                "does-not-match-with" : [
                                {
                                    "left-operand" : "$if-lldp-state",
                                    "right-operand" : "true"
                                }
                                ]
                            }
                        },
                        {
                            "term-name" : "are-frame-error-in",
                            "when" : {
                                "min-rate-of-increase" : [
                                {
                                    "field-name" : "$frame-error-in",
                                    "rate" : "$frame-error-in-threshold",
                                    "time-range" : "60s"
                                }
                                ]
                            },
                            "then" : {
                                "status" : {
                                    "color" : "red",
                                    "message" : "frame-error-in count is:$frame-error-in"
                                }
                            }
                        },
                        {
                            "term-name" : "no-frame-error-in",
                            "then" : {
                                "status" : {
                                    "color" : "green",
                                    "message" : "frame-error-in count is:$frame-error-in"
                                }
                            }
                        }
                        ]
                    },
                    {
                        "trigger-name" : "frame-error-out",
                        "synopsis" : "lldp frame output errors kpi",
                        "description" : "Sets health based on lldp session frame out error count threshold value",
                        "term" : [
                        {
                            "term-name" : "skip-lldp-disabled",
                            "when" : {
                                "does-not-match-with" : [
                                {
                                    "left-operand" : "$if-lldp-state",
                                    "right-operand" : "true"
                                }
                                ]
                            }
                        },
                        {
                            "term-name" : "are-frame-error-out",
                            "when" : {
                                "min-rate-of-increase" : [
                                {
                                    "field-name" : "$frame-error-out",
                                    "rate" : "$frame-error-out-threshold",
                                    "time-range" : "60s"
                                }
                                ]
                            },
                            "then" : {
                                "status" : {
                                    "color" : "red",
                                    "message" : "frame-error-out count is:$frame-error-out"
                                }
                            }
                        },
                        {
                            "term-name" : "no-frame-error-out",
                            "then" : {
                                "status" : {
                                    "color" : "green",
                                    "message" : "frame-error-out count is:$frame-error-out"
                                }
                            }
                        }
                        ]
                    },
                    {
                        "trigger-name" : "tlv-discards",
                        "synopsis" : "lldp tlv discards trigger",
                        "description" : "Sets health based on lldp session tlvs discard count threshold value",
                        "term" : [
                        {
                            "term-name" : "skip-lldp-disabled",
                            "when" : {
                                "does-not-match-with" : [
                                {
                                    "left-operand" : "$if-lldp-state",
                                    "right-operand" : "true"
                                }
                                ]
                            }
                        },
                        {
                            "term-name" : "are-tlv-discards",
                            "when" : {
                                "min-rate-of-increase" : [
                                {
                                    "field-name" : "$tlv-discards",
                                    "rate" : "$tlvs-discards-threshold",
                                    "time-range" : "60s"
                                }
                                ]
                            },
                            "then" : {
                                "status" : {
                                    "color" : "red",
                                    "message" : "tlv-discards count is:$tlv-discards"
                                }
                            }
                        },
                        {
                            "term-name" : "no-tlv-discards",
                            "then" : {
                                "status" : {
                                    "color" : "green",
                                    "message" : "tlv-discards count is:$tlv-discards"
                                }
                            }
                        }
                        ]
                    },
                    {
                        "trigger-name" : "unknown-tlvs",
                        "synopsis" : "lldp unknowk tlvs count kpi",
                        "description" : "Sets health based on lldp session tlvs discard count threshold value",
                        "term" : [
                        {
                            "term-name" : "skip-lldp-disabled",
                            "when" : {
                                "does-not-match-with" : [
                                {
                                    "left-operand" : "$if-lldp-state",
                                    "right-operand" : "true"
                                }
                                ]
                            }
                        },
                        {
                            "term-name" : "are-unknown-tlvs",
                            "when" : {
                                "min-rate-of-increase" : [
                                {
                                    "field-name" : "$unknown-tlvs",
                                    "rate" : "$unknown-tlvs-threshold",
                                    "time-range" : "60s"
                                }
                                ]
                            },
                            "then" : {
                                "status" : {
                                    "color" : "red",
                                    "message" : "unknown-tlvs count is:$unknown-tlvs"
                                }
                            }
                        },
                        {
                            "term-name" : "no-unknown-tlvs",
                            "then" : {
                                "status" : {
                                    "color" : "green",
                                    "message" : "unknown-tlvs count is:$unknown-tlvs"
                                }
                            }
                        }
                        ]
                    }
                    ],
                    "variable" : [
                    {
                        "name" : "frame_discards_threshold",
                        "value" : "1",
                        "description" : "Enter lldp session frame discard count threhold rate of increasing value using regular expression",
                        "type" : "int"
                    },
                    {
                        "name" : "frame_error_in_threshold",
                        "value" : "1",
                        "description" : "Enter lldp session frame in error count threhold rate of increasing
value using regular expression",
                        "type" : "int"
                    },
                    {
                        "name" : "frame_error_out_threshold",
                        "value" : "1",
                        "type" : "int"
                    },
                    {
                        "name" : "interface_name",
                        "value" : "ge-././.|xe-././.",
                        "description" : "Enter lldp session frame out error count threhold rate of increasing value using regular expression",
                        "type" : "string"
                    },
                    {
                        "name" : "tlv_discards_threshold",
                        "value" : "1",
                        "description" : "Enter lldp session tlv discard count threhold rate of increasing value using regular expression",
                        "type" : "int"
                    },
                    {
                        "name" : "unknown_tlvs_threshold",
                        "value" : "1",
                        "description" : "Enter lldp session unknown tlvs count threhold rate of increasing value using regular expression",
                        "type" : "int"
                    }
                    ]
                }
                ]
            }
            ],
            "playbook" : [
            {
                "playbook-name" : "lldp-playbook",
                "rules" : ["protocol.lldp/check-lldp-session", "protocol.lldp/check-lldp-session-statistics"],
                "description" : "This playbook checks health of each lldp session and notify in case any of the health monitored field crosses threshld",
                "synopsis" : "lldp session statistics kpi playbook"
            }
            ]
}